{% extends "base_site.html" %}

{% block title %} Lista de Usuários {% endblock title %}

{% block stylesheets %}
  {{ block.super }}
{% endblock stylesheets %}

{% block content %}
  <div class="right_col" role="main">
    <div class="">
      <div class="page-title">
        <div class="title_left">
          <h3>Usuários <small>Lista</small></h3>
        </div>

        <div class="title_right">
          <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
           <form class="form-horizontal" action="." method="get">
            <div class="input-group">
              <input id="search_box" name="search_box" type="text" class="form-control" placeholder="Pesquisar por nome..." value="{{ request.GET.search_box }}">
              <span class="input-group-btn">
                <button class="btn btn-default form-control" type="submit">Ir</button>
              </span>
            </div>
           </form>
          </div>
        </div>
      </div>

      <div class="clearfix"></div>

      <div class="row">
        <div class="col-md-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>Usuários</h2>
              <ul class="nav navbar-right panel_toolbox">
                <li><a href="{% url 'accounts:user_add' %}" class="collapse-link btn btn-dark btn-xs"><i class="fa fa-plus"><b> Add</b></i></a>
                
                </li>
              </ul>
              <div class="clearfix"></div>
            </div>
            <div id="listItems" class="x_content">

              <!-- <p>Simple table with project listing with progress and editing options</p> -->

              <!-- start project list -->
              <table class="table table-striped projects">
                <thead>
                  <tr>
                    <th style="width: 1%">#</th>
                    <th style="width: 30%">Nome</th>
                    <th>Status</th>
                    <th>Permissões</th>
                    <th style="width: 20%">#Ações</th>
                  </tr>
                </thead>
                <tbody>
                {% for user in object_list %}
                  <tr>
                    <td>{{user.id}}</td>
                    <td>
                      
                      <a>{% if user.name %} {{user.name}} {% else %} - {% endif %}</a>
                      <br />
                      <small>Username: {{user.username}}</small>
                    </td>

                    <td>
                      {% if user.is_active %} 
                        <button type="button" class="btn btn-success btn-xs">Ativo</button>
                      {% else %}
                        <button type="button" class="btn btn-warning btn-xs">Inativo</button>

                      {% endif %}
                    </td>
                    <td>
                      {% if user.is_staff %} 
                        <button type="button" class="btn btn-success btn-xs">Equipe</button>
                      {% else %}
                        <button type="button" class="btn btn-danger btn-xs">Equipe</button>
                      {% endif %}
                      {% if user.is_superuser %} 
                        <button type="button" class="btn btn-success btn-xs">Super Usuário</button>
                      {% else %}
                        <button type="button" class="btn btn-danger btn-xs">Super Usuário</button>
                      {% endif %}                      
                    </td>
                    <td>
                      <div class="cent">
                        <a href="{% url 'accounts:user_details' user.id %}" class="btn btn-primary btn-xs"><i class="fa fa-folder"></i> Ver </a>
                        <a href="{% url 'accounts:user_edit' user.id %}" class="btn btn-info btn-xs"><i class="fa fa-pencil"></i> Editar </a>   
                        
                        <a href="#" class="btn btn-danger btn-xs" onclick="delete_user({{ user.id }});">
                          <i class="fa fa-trash-o">Deletar</i>
                        </a>
                      </div>
                      

                    </td>
                  </tr>

                {% endfor %}  
                </tbody>
              </table>
              

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block javascripts %}
  {{ block.super }}
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


<script type="text/javascript">
  $(document).ready(function() {
    setTimeout(function() {
      $('#msg').slideUp(1500);}, 5000);
    });

    
    function delete_user(id_user){
      
      if (window.location.protocol == 'http:') {
        url = "http://{{ request.get_host }}/accounts/"+ id_user + "/delete";
      }else{
        url = "https://{{ request.get_host }}/accounts/"+ id_user + "/delete";
      }

      $.getJSON(url, function(data){
        if(data.code==200){          
          
          swal('Excluido!', data.msg, "success");


        }else{
          swal('Falha!', data.msg, "error");
          $("#id_student").empty();
        }
      });

    }
  </script>

{% endblock javascripts %}
